<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 掌握Node.js的文件系统[File System 基础] · Hexo</title><meta name="description" content="Node最引以为傲的就是它有一个非常小的核心，有一些语言绑定了完整的POSIX API,而Node实现了尽可能少的绑定，并通过同步，异步或流API形式暴露他们。
这种方法意味着，操作系统中有一些非常方便的功能，需要在Node中重建。这是一个教你如何使用文件系统软件包的实用教程。
引用文件与文件系统的交互很重要的一点是要指向正确的文件。由于NPM的包使用相对路径引用，所以你不能把路径写死在代码。有两个主要方式来以确保包能引用到正确的文件
123456&lt;/s"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/Vb/" target="_self" class="nav-list-link">V币商城</a></li><li class="nav-list-item"><a href="https://github.com/runlijs" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">掌握Node.js的文件系统[File System 基础]</h1><div class="post-meta"><div class="post-time">Jan 18, 2016</div></div><div class="post-content"><p>Node最引以为傲的就是它有一个非常小的核心，有一些语言绑定了完整的POSIX API,而Node实现了尽可能少的绑定，并通过同步，异步或流API形式暴露他们。</p>
<p>这种方法意味着，操作系统中有一些非常方便的功能，需要在Node中重建。这是一个教你如何使用文件系统软件包的实用教程。</p>
<h1 id="u5F15_u7528_u6587_u4EF6"><a href="#u5F15_u7528_u6587_u4EF6" class="headerlink" title="引用文件"></a>引用文件</h1><p>与文件系统的交互很重要的一点是要指向正确的文件。由于NPM的包使用相对路径引用，所以你不能把路径写死在代码。有两个主要方式来以确保包能引用到正确的文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//使用'path.join()'而不是'+'确保Windows也能正常工作</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到基于调用点的相对路径，对于命令行程序(CLI applications)非常实用</span></span><br><span class="line">path.join(process.cwd(),<span class="string">'my-dynamic-file'</span>);</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">path.resolve(<span class="string">'my-dynamic-file'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基于一个文件找到别一个文件</span></span><br><span class="line">path.join(__dirname,<span class="string">'my-dynamic-file'</span>)</span><br></pre></td></tr></table></figure>
<h1 id="u8BFB_u53D6_u6587_u4EF6"><a href="#u8BFB_u53D6_u6587_u4EF6" class="headerlink" title="读取文件"></a>读取文件</h1><p>在节点中的异步读取文件是最简单方法就是使用流！下面是一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs   = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">fs.createReadStream(path.join(__dirname,<span class="string">'my-file'</span>))</span><br><span class="line">.pipe(process.stdout);</span><br></pre></td></tr></table></figure>
<h1 id="u521B_u5EFA_u6587_u4EF6"><a href="#u521B_u5EFA_u6587_u4EF6" class="headerlink" title="创建文件"></a>创建文件</h1><p>创建文件也并不是很难，这时在有一个用node实现的cat命令</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line">fs.createReadStream(path.join(__dirname,<span class="string">'my-file'</span>))</span><br><span class="line">.pipe(fs.createWriteStream(path.join(__dirname,<span class="string">'my-other-file'</span>)))</span><br></pre></td></tr></table></figure>
<h1 id="u5220_u9664_u6587_u4EF6"><a href="#u5220_u9664_u6587_u4EF6" class="headerlink" title="删除文件"></a>删除文件</h1><p>要Shell脚本中删除的文件和目录通常使用 rm -rf命令。NodeJS中有一个的rimraf也实现了相同的功能</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> rimraf = <span class="built_in">require</span>(<span class="string">'rimraf'</span>);</span><br><span class="line"><span class="keyword">const</span> path   = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">rimraf(path.join(__dirname,<span class="string">'./my-directory'</span>),err =&gt; &#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="u521B_u5EFA_u76EE_u5F55"><a href="#u521B_u5EFA_u76EE_u5F55" class="headerlink" title="创建目录"></a>创建目录</h1><p>创建跟删除文件很相似，使用mkdirp包</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> mkdirp = <span class="built_in">require</span>(<span class="string">'mkdirp'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line">mkdirp(path.join(__dirname,<span class="string">'foo/bar'</span>),err=&gt;&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="u67E5_u627E_u6587_u4EF6"><a href="#u67E5_u627E_u6587_u4EF6" class="headerlink" title="查找文件"></a>查找文件</h1><p>使用readdirp查找当前目录下的文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> readdirp = <span class="built_in">require</span>(<span class="string">'readdirp'</span>);</span><br><span class="line"><span class="keyword">const</span> json = <span class="built_in">require</span>(<span class="string">'JSONStream'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// recursively print out all files in all subdirectories</span></span><br><span class="line"><span class="comment">// to the command line. The object stream must be</span></span><br><span class="line"><span class="comment">// stringified before being passed to `stdout`.</span></span><br><span class="line">readdirp(&#123;root:path.join(__dirname)&#125;)</span><br><span class="line">	.pipe(json.stringify())</span><br><span class="line">	.pipe(process.stdout)</span><br></pre></td></tr></table></figure>
<p>使用findup查找当前父级目录中的文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> findup = <span class="built_in">require</span>(<span class="string">'findup'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// recurse up all files relative to __dirname and find</span></span><br><span class="line"><span class="comment">// all `package.json` files.</span></span><br><span class="line">findup(path.join(__dirname),<span class="string">'package.json'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'dir is:'</span> + res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注* 稳健性</p>
<p>虽然我从来没有用过，但我听说有个 <a href="https://node-graceful-fs" target="_blank" rel="external">node-graceful-fs</a>的包也很不错。它有重试，队列和其他一些好东西。</p>
<p>注* 关于管道(pipes)</p>
<p>在管道中对整个数据流的错误进行一次处理非常。而不用对每个单独的数据流使用 .on(‘error’, cb) :</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> pump = <span class="built_in">require</span>(<span class="string">'pump'</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// oh no,no errors add handled!</span></span><br><span class="line">fs.createReadStream(<span class="string">'./in.file'</span>).pipe(fs.createWriteStream(<span class="string">'./out.file'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// that`s better,we`re handing errors now</span></span><br><span class="line"><span class="keyword">const</span> rs = fs.creatsReadStream(<span class="string">'./in.file'</span>);</span><br><span class="line"><span class="keyword">const</span> ws = fs.creatsWriteStream(<span class="string">'./out.file'</span>);</span><br><span class="line">pump(rs,ws,err=&gt;&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><a href="http://ourjs.com/detail/56162a63e3312b046d27f53e" target="_blank" rel="external">转载自</a>;</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/03/03/html-input-number-移位小箭头/" class="prev">上一篇</a><a href="/2016/01/17/mac的nginx安装和配置/" class="next">下一篇</a></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?a36e15d9e2adec9a21fcdd9f686b1ed2";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>